From c2a781afcd224468a2ba7bc7546eb1477877122f Mon Sep 17 00:00:00 2001
From: Augusto Righetto <aurighet@microsoft.com>
Date: Tue, 30 Jun 2020 08:49:50 -0700
Subject: [PATCH] Removing code that only runs on Win32 from the build

---
 rtc_base/BUILD.gn                 | 7 +++++++
 rtc_base/platform_thread_types.cc | 6 ++++++
 2 files changed, 13 insertions(+)

diff --git a/rtc_base/BUILD.gn b/rtc_base/BUILD.gn
index c62b3f6afe..361907b494 100644
--- a/rtc_base/BUILD.gn
+++ b/rtc_base/BUILD.gn
@@ -979,6 +979,13 @@ rtc_library("rtc_base") {
       "win32_window.h",
     ]
 
+    if (current_os == "winuwp") {
+      sources -= [
+        "win32_window.cc",
+        "win32_window.h",
+      ]
+    }
+
     libs += [
       "crypt32.lib",
       "iphlpapi.lib",
diff --git a/rtc_base/platform_thread_types.cc b/rtc_base/platform_thread_types.cc
index b0243b41dc..03143a5141 100644
--- a/rtc_base/platform_thread_types.cc
+++ b/rtc_base/platform_thread_types.cc
@@ -70,9 +70,15 @@ void SetCurrentThreadName(const char* name) {
 #if defined(WEBRTC_WIN)
   // The SetThreadDescription API works even if no debugger is attached.
   // The names set with this API also show up in ETW traces. Very handy.
+#if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_APP) && \
+    !WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP)
+  // ::GetModuleHandleA is not available on UWPs.
+  static auto set_thread_description_func = &::SetThreadDescription;
+#else
   static auto set_thread_description_func =
       reinterpret_cast<RTC_SetThreadDescription>(::GetProcAddress(
           ::GetModuleHandleA("Kernel32.dll"), "SetThreadDescription"));
+#endif  // WINAPI_PARTITION_APP && !WINAPI_PARTITION_DESKTOP
   if (set_thread_description_func) {
     // Convert from ASCII to UTF-16.
     wchar_t wide_thread_name[64];
-- 
2.24.1.windows.2

